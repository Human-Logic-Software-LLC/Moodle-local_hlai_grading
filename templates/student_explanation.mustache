{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_hlai_grading/student_explanation

    Student-facing grade explanation template.

    Context variables required for this template:
    * gradevalue - The grade value
    * grademax - Maximum grade
    * hasconfidence - Whether confidence is available
    * confidence - Confidence text
    * hasreasoning - Whether overall reasoning is available
    * overallheading - Heading for overall section
    * reasoningparagraphs - Array of reasoning paragraphs
    * strengthsheading - Heading for strengths
    * hasstrengths - Whether strengths exist
    * strengths - Array of strength items
    * strengthsempty - Message when no strengths
    * improvementsheading - Heading for improvements
    * hasimprovements - Whether improvements exist
    * improvements - Array of improvement items
    * improvementsempty - Message when no improvements
    * hascriteria - Whether criteria breakdown exists
    * criteriaheading - Heading for criteria section
    * expandall - Expand all button text
    * collapseall - Collapse all button text
    * criteria - Array of criteria objects
    * hasexamples - Whether examples exist
    * examplesheading - Heading for examples
    * examples - Array of example objects

    Example context (json):
    {
        "gradevalue": "85",
        "grademax": "100",
        "hasstrengths": true,
        "strengths": ["Good structure", "Clear arguments"]
    }
}}
<div class="ai-explain-summary">
    <div class="ai-explain-grade">
        <span class="ai-explain-grade-value">{{gradevalue}}</span>
        <span class="ai-explain-grade-max">/ {{grademax}}</span>
    </div>
    {{#hasconfidence}}
        <p class="ai-explain-confidence">{{confidence}}</p>
    {{/hasconfidence}}
    {{#hasreasoning}}
        <div class="ai-explain-overall">
            <h5>{{overallheading}}</h5>
            {{#reasoningparagraphs}}
                <p>{{{.}}}</p>
            {{/reasoningparagraphs}}
        </div>
    {{/hasreasoning}}
</div>

<div class="ai-explain-section">
    <h5>{{strengthsheading}}</h5>
    {{#hasstrengths}}
        <ul class="ai-explain-list">
            {{#strengths}}
                <li>{{.}}</li>
            {{/strengths}}
        </ul>
    {{/hasstrengths}}
    {{^hasstrengths}}
        <p class="text-muted">{{strengthsempty}}</p>
    {{/hasstrengths}}
</div>

<div class="ai-explain-section">
    <h5>{{improvementsheading}}</h5>
    {{#hasimprovements}}
        <ul class="ai-explain-list improvements">
            {{#improvements}}
                <li>{{.}}</li>
            {{/improvements}}
        </ul>
    {{/hasimprovements}}
    {{^hasimprovements}}
        <p class="text-muted">{{improvementsempty}}</p>
    {{/hasimprovements}}
</div>

{{#hascriteria}}
    <div class="ai-explain-section">
        <div class="ai-explain-section-header">
            <h5>{{criteriaheading}}</h5>
            <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-link p-0 me-3" id="expand-all-criteria">{{expandall}}</button>
                <button type="button" class="btn btn-link p-0" id="collapse-all-criteria">{{collapseall}}</button>
            </div>
        </div>
        <div class="ai-explain-criteria">
            {{#criteria}}
                <div class="ai-criterion" data-criterion="{{id}}">
                    <div class="ai-criterion-header">
                        <div>
                            <div class="ai-criterion-name">{{name}}</div>
                            {{#levelname}}
                                <div class="ai-criterion-level">{{levelname}}</div>
                            {{/levelname}}
                        </div>
                        <div class="ai-criterion-score">{{pointslabel}}</div>
                    </div>
                    <button type="button"
                        class="btn btn-link criterion-explain-btn"
                        data-criterionid="{{id}}"
                        aria-controls="reasoning-{{id}}"
                        aria-expanded="false">
                        {{togglelabel}}
                    </button>
                    {{#hasreasoning}}
                        <div class="criterion-reasoning" id="reasoning-{{id}}">
                            {{#reasoningparagraphs}}
                                <p>{{{.}}}</p>
                            {{/reasoningparagraphs}}
                        </div>
                    {{/hasreasoning}}
                </div>
            {{/criteria}}
        </div>
    </div>
{{/hascriteria}}

{{#hasexamples}}
    <div class="ai-explain-section">
        <h5>{{examplesheading}}</h5>
        <div class="ai-explain-examples">
            {{#examples}}
                <div class="ai-example {{typeclass}}">
                    <div class="ai-example-label">{{label}}</div>
                    {{#text}}
                        <blockquote>{{.}}</blockquote>
                    {{/text}}
                    {{#comment}}
                        <p>{{.}}</p>
                    {{/comment}}
                </div>
            {{/examples}}
        </div>
    </div>
{{/hasexamples}}
